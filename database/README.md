# Test Database Fixtures

This directory contains test data for smoke tests and development.

## Files

| File | Description |
|------|-------------|
| `schema.sql` | Database schema (structure only, no data) |
| `test-fixtures.sql` | Test data with deterministic IDs for smoke tests |
| `init.sql` | Production database backup (reference only) |
| `2026-01-04-1534-schema.sql` | Schema backup from production |

## Quick Start

### Import Test Data

```bash
# Import schema
docker compose exec -T db mysql -uhhbd -phhbd_password hhbd < database/schema.sql

# Import test fixtures
docker compose exec -T db mysql -uhhbd -phhbd_password hhbd < database/test-fixtures.sql

# Generate test images
docker compose exec app php app/tools/generate-test-images.php
```

### All-in-One Setup

```bash
# Recreate database with test data
docker compose exec -T db mysql -uroot -proot_password -e "DROP DATABASE IF EXISTS hhbd; CREATE DATABASE hhbd;"
docker compose exec -T db mysql -uhhbd -phhbd_password hhbd < database/schema.sql
docker compose exec -T db mysql -uhhbd -phhbd_password hhbd < database/test-fixtures.sql
docker compose exec app php app/tools/generate-test-images.php
```

## Test Data Contents

### Database Records

| Table | Records | Notes |
|-------|---------|-------|
| artists | 51 | Including Pezet, Eldo, Mes (ID 35), etc. |
| albums | 50 | Including "Jestem Hip Hopem", Superextra (ID 535) |
| songs | 31 | Including Pogoda (ID 7329) with features |
| labels | 15 | Including Alkopoligamia (ID 58), Asfalt |
| news | 6 | Including ID 1877 (Onar article) |
| artists_photos | 30 | Linked to main artists |
| hhb_users | 10 | Test users for ratings/comments |
| ratings | 100 | For Top10 rankings |
| ratings_avg | 50 | Average ratings for albums |
| searches | 15 | Popular search terms |

### Test Images

Generated by `app/tools/generate-test-images.php`:

| Type | Count | Directory | Filename Pattern |
|------|-------|-----------|------------------|
| Album covers | 50 | `content/a/` | `test-cover-001.jpg` to `test-cover-050.jpg` |
| Artist photos | 30 | `content/p/` | `test-artist-001.jpg` to `test-artist-030.jpg` |
| Label logos | 15 | `content/l/` | `test-label-001.jpg` to `test-label-015.jpg` |

**Total:** 95 placeholder images (100x100px, ~1.5KB each)

## Smoke Test Requirements

The test fixtures include specific records required by smoke tests:

### Required IDs

| Entity | ID | Content |
|--------|-----|---------|
| Artist | 35 | Mes (Piotr  Szmidt) |
| Album | 535 | Superextra (by Wdowa, label Alkopoligamia) |
| Song | 7329 | Pogoda (features Dj Technik, Beatmo) |
| Label | 58 | Alkopoligamia |
| News | 1877 | ONAR article with "Onar wraca z nowym singlem" |

### Required Content

- Homepage: Contains "Pezet"
- Album list: Contains "Jestem Hip Hopem"
- Premieres: Contains "Stasiak"
- Artist list: Contains "Eldo"
- Label list: Contains "Asfalt"
- Search "tede": Returns "Mefistotedes" and "MercTedes"
- Top10 page: 70+ list items, 40+ thumbnails

## CI/CD Usage

GitHub Actions workflow (`.github/workflows/smoke-tests.yml`) automatically:

1. Imports `database/schema.sql`
2. Imports `database/test-fixtures.sql`
3. Generates test images via `app/tools/generate-test-images.php`
4. Runs smoke tests

## Polish Characters

Test data includes Polish characters (ą, ę, ć, ź, ż, ó, ł, ś, ń) in:
- Artist names
- Album titles
- Song lyrics
- News content
- Photo descriptions

## Updating Test Data

To add more test data:

1. Edit `database/test-fixtures.sql`
2. Maintain deterministic IDs for smoke test requirements
3. Update image references if needed
4. Test locally before pushing

## Production Data

**DO NOT** use test fixtures in production. Use `database/init.sql` or a production backup instead.
